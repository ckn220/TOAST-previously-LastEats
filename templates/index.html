{% extends "skeleton.html" %}
{% block style %}
<meta property="og:image" content="http://beta.lasteats.com/static/assets/img/CURRENT_LOGO_WHITE.png">

<meta name="Description" content="Find the best meals chosen by your friends for cities all over the world.">

{% endblock %} 

{% block body %}

<style>
	@media (min-width: 60em) {
		.main-content {
			max-width:900px;
		}
	}
</style>

<script>
function startSlider(){
	if ($('.photo_slider .ideaItem').first().height() > 0){
		$('.photo_slider').height($('.photo_slider .ideaItem').first().height());
		$('.photo_slider .ideaItem').first().show();
		$('.photo_slider').addClass('transition');
		$('.photo_slider .ideaItem').first().addClass('active');
	}
	else {
		delayStart();
	}
}
function delayStart(){
	setTimeout(function(){
		startSlider();
	},10);
}
</script>

{% include "facebook.html" %}

<div data-role="page" class="jqm-demos" data-quicklinks="false">
	
	
	<div role="main" class="ui-content jqm-content main-content" data-ajax-warning="false" style='padding-top:0px;text-align:center;'>
		
		<div class='hiddenSlider transition' style='background:#f95d64;color:white;text-shadow:none;position:relative;overflow:hidden;height:0px;'>
			<div class='hiddenSliderCont'>
					<div><br></div>
				
				<div style='color: #f95d64;font-size: 2em;background: white;position: absolute;right: 10px;top: 10px;
								padding: 0px 9px;border-radius: 100px;cursor:pointer;z-index:10;' onclick='$(this).parent().parent().height("0px")'>&#10006;</div>
				
				<div class='col-sm-4 transition active' num='1' style='left:0%;'>
					<img src='/static/img/top1.png' style='width:240px;' />
					<h2>That one special place</h2>
					<div>Last Eats is a place to showcase your favorite meal in a city -- the one place
						that you love most right now. Add as many cities as you want!</div>
					<div class='mobileContent'>
						<div class='hiddenDot active'></div>
						<div class='hiddenDot '></div>
						<div class='hiddenDot '></div>
					</div>
				</div>
				
				<div class='col-sm-4 transition' num='2'>
					<img src='/static/img/top2.png' style='width:240px;'/>
					<h2>Friends helping friends find great food</h2>
					<div>Word of mouth recommendations from the people you know and trust the most.
						If you only had time for one meal, where would you go?</div>
					<div class='mobileContent'>
						<div class='hiddenDot '></div>
						<div class='hiddenDot active'></div>
						<div class='hiddenDot '></div>
					</div>
				</div>
				
				<div class='col-sm-4 transition' num='3'>
					<img src='/static/img/top3.png' style='width:240px;' />
					<h2>Restaurants change and so can you</h2>
					<div>Just like with your Facebook profile photo, nothing is set in stone.  Share the places you love the most right now
						and change them whenever you like.</div>
					<div class='mobileContent'>
						<div class='hiddenDot '></div>
						<div class='hiddenDot '></div>
						<div class='hiddenDot active'></div>
					</div>
					
				</div>
				
				
				<div class='mobileContent'>
					<div class='arrowLeft' style='top:30%;' onclick='swipeCol(-1)'></div>
					<div class='arrowRight' style='top:30%;' onclick='swipeCol(1)'></div>
				</div>
				<br><br>
			</div>
		
		</div>
		
		<div class='topPhoto'>
			<br><br><br>
			<img src="/static/assets/img/CURRENT_LOGO_WHITE.png" onclick='openCover("/newsfeed")' height="125" width="125" style=''>
			<br><br><br>
			
			<h2 class='backgroundText' style='padding:10px 30px;'>
				Find <b>the best meals</b> chosen by <br><b>your friends</b> for cities all <b>over the world.</b>
			</h2>
			
			<div style=''>
				<a data-role="button" class="button"  onclick='openCover("/newsfeed")' style='border:none;'>Login to Last Eats</a><br>
				<a style='display: inline-block;margin: 5px 0px;padding: 5px 15px;width: 212px;background: rgba(0,0,0,.4);
								color: white !important;margin-bottom: 15px;text-shadow: none;' 
					data-role="button" onclick='$(".hiddenSlider").height($(".hiddenSliderCont .col-sm-4").height()+parseInt($(".hiddenSliderCont .col-sm-4").css("padding-top"))*2+38)' style='border:none;'>How It Works</a>
			</div>
			<br><br>
		</div>
		
		<div style='width:100%;clear:both;'></div>
		
		<div style='background:#8f8f8f;text-align:left;'><br><br>
			<div class='desktopContent' style='padding:0px 60px;'>
			<div style='display:inline-block;width:60%;vertical-align:top;'>
				<h1 style='color:white;text-align:left;text-shadow:none;'>Browse the best food</h1>
				<a href='/browse' data-role="button" style='display: inline-block;'>Near Me</a>
				<a href='/city_filter' data-role="button" style='display: inline-block;'>By City</a>
				<a onclick='openCover("/map")' data-role="button" style='display: inline-block;'>By Map</a>
				<a onclick='openCover("/my_friends")' data-role="button" style='display: inline-block;'>By Friends</a>
			</div>
			<div style='display:inline-block;width:35%;vertical-align:top;'>
				<h1 style='color:white;text-align:left;text-shadow:none;'>Add Last Eats</h1>
				<a href='/add_last_eats' data-role="button" style='display: inline-block;'>Add Your Favorites</a>
				
			</div>
			</div>
			<div class='mobileContent'>
				<h1 style='color:white;text-shadow:none;text-align:center;'>Browse the best food</h1>
				<a href='/browse' data-role="button" style='margin:10px auto;width: 158px;'>Near Me</a>
				<a href='/city_filter' data-role="button" style='margin:10px auto;width: 158px;'>By City</a>
				<a onclick='openCover("/map")' data-role="button" style='margin:10px auto;width: 158px;'>By Map</a>
				<a onclick='openCover("/my_friends")' data-role="button" style='margin:10px auto;width: 158px;'>By Friends</a>
				<br><br>
			</div>
			<br><br>
		</div>
		
		<div style='background:#efefef;'>
			<br><br>
			
			<h1 style='font-size:2em;font-weight:normal;'>Recent Last Eats Declarations</h1>
			<h2 style='font-weight:normal;'>The best, most recently added restaurants</h2>
			<br><br>
		</div>
		
		<div class='mobileContent'>
		<div class='photo_slider' style='position:relative;'>
			{% for item in ideas -%}
				{% if loop.index0 == 0 %}
				<div class='ideaItem transition' style='left:0%;'>
					<img class='ideaImage' src='{{ item.filename['url'] }}' onload='startSlider();' />
				{% else %}
				<div class='ideaItem transition'>
					<img class='ideaImage' src='{{ item.filename['url'] }}' />
				{% endif  %}
					
					<a style='background:rgba(255,255,255,.5);' class='ideaHover' href="last_eat_entry/{{ item.id }}">
						<div class='ideaHoverInner' style='{%if item.restaurant_name|length<32%}font-size: 1.2em;{%endif%}font-weight: normal;'>
							<img src='{{ friends[item.userid].picture }}' />
							<br><br>
							<div class='name'><b>{{ item.restaurant_name }}</b></div>
							<div class='city'>{{ item.display_city }}</div>
						</div>
					</a>
				</div>
			{%- endfor %}
			<div class='arrowLeft' onclick='swipePhoto(-1)'></div>
			<div class='arrowRight' onclick='swipePhoto(1)'></div>
		</div></div>
		
		<div class='desktopContent'>
			{% for item in ideas -%}
				<a class='ideaItem' href="last_eat_entry/{{ item.id }}">
					<img class='ideaImage' src='{{ item.filename['url'] }}' />
					
					<div style='background:rgba(255,255,255,.5);' class='ideaHover'>
						<div class='ideaHoverInner' style='font-size: 1.2em;font-weight: normal;'>
							<img src='{{ friends[item.userid].picture }}' />
							<br><br>
							<div class='name'><b>{{ item.restaurant_name }}</b></div>
							<div class='city'>{{ item.display_city }}</div>
						</div>
					</div>
				</a>
			{%- endfor %}
		</div>
		
		<div style='background:#efefef;'>
		<br><br><br><br>
		<h1 style='font-size:2em;font-weight:normal;'>Your recommendations count.</h1>
		<h2 style='font-weight:normal;'>Help spread the word.</h2>
		<br>
		
		<a href='https://www.facebook.com/sharer/sharer.php?src=sp&u=http://beta.lasteats.com/'><img style='width:60px;padding:10px;' src='/static/img/facebookIcon.png' /></a>
		<a href='https://twitter.com/intent/tweet?text=http://beta.lasteats.com/'><img style='width:60px;padding:10px;' src='/static/img/twitterIcon.png' /></a>
		<br><br><br><br>
		</div>
		
		<div class='bottomPhoto' style='text-align:center;padding:0px 60px;text-align:left;'>
			<br><br><br><br><br><br><br>			
			<div style='max-width:500px;margin:0px auto;'>
				<h2 class='backgroundText' >If I only had time for one meal in:</h2>
				<div class='error_message' style='display:none;padding:5px 0px;margin:5px 0px;background:#faa;'></div>
				<input type="text" name="textinput-4" id="textinput-4" placeholder="Enter a City" value="">
				<input type="hidden" id="cityLat" name="cityLat" />
				<input type="hidden" id="cityLng" name="cityLng" />
				
				</br>
				<h2 class='backgroundText' >I'd go to:</h2>
				<div class='error_message2' style='display:none;padding:5px 0px;margin:5px 0px;background:#faa;'></div>
				<div id="geocode">
					<input id="address" class="controls" type="text" placeholder="Enter a Restaurant" value="">
					<input type="hidden" id="addressName" name="addressName" />
					<input type="hidden" id="addressLat" name="addressLat" />
					<input type="hidden" id="addressLng" name="addressLng" />
				</div> 
				
				<input type="hidden" value="Drop your pin" onclick="codeAddress()">
				<div class="form_next"><a data-role="button" style="background: #grey; color: black;" onclick='moveOn()'>Add Your Last Eats</a></div>
		</div>
			<!-- <h2 class='backgroundText' style='padding:10px 30px;'>
				If you only had time for one great meal in<br> {{ locationIdea.title }}, where would you go?</h2><br><br><br>
			<a href="/city?name={{ locationIdea.title }}" data-role="button" style="display: inline-block;background: #grey; color: black;width: 213px;margin: 5px 0px;">Browse Last Eats <br>in {{ locationIdea.title }}</a>
			-->
			
			<br><br><br><br><br>
		</div>

		
		{% if users != None %}
			{% for item in users -%}
				<div style='margin:4px;padding:4px;display:inline-block;'><img src='{{ item.picture }}' style='width:50px;border-radius:50px;'><a href='/?userid={{ item.userid }}'>{{ item.user_name }} {{ item.user_last_name }}</a></div>
			{%- endfor %}
		{% else %}
			<div style='text-align:center;'><img id="login" onclick="FB.login(function(response) {if (response.authResponse) {testAPI();}else {}}, { scope: 'email' });" src='/static/img/fbook.jpg' /></div>
		{% endif %}
		
	</div><!-- /page -->
	
	<div class='footer' style='background:#c5c5c5;text-align:center;width:100%;'>
		<br><br>
		<a href='mailto:colin@lasteats.com'>Contact Us</a>
		<br><br>
	</div>
	
	<div class='cover' style='position:fixed;width:100%;height:100%;top:0px;left:0px;background:rgba(255,255,255,.5);display:none;text-align:center;'>
		<div style='position:relative;margin:100px 0px;display:inline-block;background:white;padding:60px;text-align:center;border:2px solid #aaa;'>
			<div class='close' onclick='closeCover()'>x</div>
			<div style='display:inline-block;vertical-align:top;'>
				<img id="login" onclick="FB.login(function(response) {if (response.authResponse) {testAPI();}else {}}, { scope: 'email' });" src='/static/img/fbook.jpg' style='height:40px;' />
				<input type='hidden' name='url' value='/newsfeed' />
			</div><br><br>
			<div style='display:inline-block;vertical-align:top;'><img id="login" src='/static/img/twitter.jpg' style='opacity:.3;height:40px;' /><div>Coming Soon!</div></div>
		</div>
	</div>
	
</div><!-- /panel -->



{% endblock %}


{% block scripts %}

<script>
	function closeCover(){
		$('.cover').hide();
	}
	function openCover(url){
		$('.cover').show();
		$('input[name="url"]').val(url);
		
	}
	
	
	$(document).on('pageinit', function(event){
		$(".photo_slider").swipeleft(function() {
			swipePhoto(1);
		});
		
		$(".photo_slider").swiperight(function() {
			swipePhoto(-1);
		});
		
		$('.photo_slider img').on('dragstart', function(event) { event.preventDefault(); });
		
		$('.ideaItem').on('click',function(){
	        $(this).children('.ideaHover').show();
	    });
	    
	    
	    $(".hiddenSlider").swipeleft(function() {
			swipeCol(1);
		});
		
		$(".hiddenSlider").swiperight(function() {
			swipeCol(-1);
		});
	});
	
	function swipePhoto(dir){
		
		if (dir == 1){
			var old = $('.photo_slider .ideaItem.active');
			old.css('left', '-100%');
			old.removeClass('active');
			var next = old.next('.photo_slider .ideaItem');
			if (next.length == 0){
				next = $('.photo_slider .ideaItem').first();}
			next.show();
			
			setTimeout(function(){
				next.css('left','0%');
				next.addClass('active');
				$('.photo_slider').height(next.height());
				setTimeout(function(){
					old.css('left','100%');
					old.hide();
				},200);
			}, 10);
		}
		else {
			var old = $('.photo_slider .ideaItem.active');
			old.css('left', '100%');
			old.removeClass('active');
			var next = old.prev('');
			if (next.length == 0){
				next = $('.photo_slider .ideaItem').last();}
			next.css('left','-100%');
			next.show();
			
			setTimeout(function(){
				next.css('left','0%');
				next.addClass('active');
				$('.photo_slider').height(next.height());
				setTimeout(function(){
					old.hide();
				},200);
			}, 10);
		}
	}
	function swipeCol(dir){
		
		if (dir == 1){
			var old = $('.hiddenSlider .col-sm-4.active');
			old.css('left', '-300%');
			old.removeClass('active');
			var next = old.next('.hiddenSlider .col-sm-4');
			if (next.length == 0){
				next = $('.hiddenSlider .col-sm-4').first();}
			next.show();
			
			setTimeout(function(){
				next.css('left','0%');
				next.addClass('active');
				setTimeout(function(){
					old.css('left','100%');
					old.hide();
				},200);
			}, 10);
		}
		else {
			var old = $('.hiddenSlider .col-sm-4.active');
			old.css('left', '100%');
			old.removeClass('active');
			var next = old.prev('.hiddenSlider .col-sm-4');
			if (next.length == 0){
				next = $('.hiddenSlider .col-sm-4').last();}
			next.css('left','-300%');
			next.show();
			
			setTimeout(function(){
				next.css('left','0%');
				next.addClass('active');
				setTimeout(function(){
					old.hide();
				},200);
			}, 10);
		}
	}
</script>

<script>
var ajax_loading = 0;
function moveOn(){
	
	var city = $('#textinput-4').val();
	var addressName = $('#addressName').val();
	var addressLat = $('#addressLat').val();
	var addressLng = $('#addressLng').val();
	var cost = $('input[name=cost]:checked').val();
	var warned = false;
	if ($('.error_message').css('display') != 'none'){
		warned = true;}
	
	if (addressName == '' || addressLat == '' || addressLng == ''){
		$('.error_message2').html("Sorry we couldn't find that restaurant");
		$('.error_message2').show();
	}
	else if (ajax_loading == 0){
		$('.form_next a').html('Loading . . . ');
		ajax_loading = 1;
		$.ajax({
			url: 'add_last_eats',
			type: "post",
			data: {'city': city,
					'addressName': addressName,
					'addressLat': addressLat,
					'addressLng': addressLng,
					'cost': cost,
					'requestid': reqId,
					'warned': warned},
			success: function(value) {
				ajax_loading = 0;
				console.log(value);
				if('error' in value && $('.error_message').css('display') == 'none'){
					$('.error_message').html(value.error);
					$('.error_message').show();
					$('.form_next a').html('Tell us more!');
				}
				else{
					window.location = "/add_last_eats_next?id="+value.id;
				}
			},
			error: function(xhr, status, error) {
				console.log(xhr.responseText);
				$('.form_next a').html('Woops we hit an error!');
			}
		});
	}
	
}

var req = {'lati': {{ locationIdea.point.coordinates[1] }},'long': {{ locationIdea.point.coordinates[0] }}};
var reqId = "{{ locationIdea.id }}";
$("#textinput-4").val("{{ locationIdea.full_city }}");

</script>

<script src="/static/js/mapquest.js"></script>
{% endblock %}


