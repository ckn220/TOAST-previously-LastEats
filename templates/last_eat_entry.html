{% extends "skeleton.html" %}

{% block body %}
	
<div data-role="page" class="jqm-demos" data-quicklinks="false">
	{% if current_user != None %}
		{% include "header.html" %}
	{% else %}
		{% include "header_med.html" %}
	{% endif %}
		
	<div role="main" class="ui-content jqm-content main-content" data-ajax-warning="false">
		</br>
		
		<div class="user_photo"><img src="{{ friend.picture  }}" height="125" width="125"></div>
		<div class="user_choice"><p><strong>{{ friend.user_name }} {{ friend.user_last_name }}</strong></p></div>
		
		<div class="user_choice">
			<p>If I only had time for one meal in <strong>{{ idea.title }}</strong>, I'd go to:</p>
		</div>
		
		<div class="user_restaurant">
			<strong>{{ idea.restaurant_name }}</strong>
		</div><!-- /demo-html -->
		
		{% if current_user != None %}
		<table class='icon_container'><tr>
			<td width='33%'><a class='icon comment' href='#guest_book'></a></td>
			{% if user.userid in idea.likes %}
				<td width='33%'><div class='icon loved' onclick='loveIdea(this, "{{ idea.id }}")'></div></td>
			{% else %}
				<td width='33%'><div class='icon love' onclick='loveIdea(this, "{{ idea.id }}")'></div></td>
			{% endif %}
			
			{% if idea_id in user.saves %}
				<td width='33%'><div class='icon saved' onclick='saveIdea(this, "{{ idea.id }}")'></div></td>
			{% else %}
				<td width='33%'><div class='icon save' onclick='saveIdea(this, "{{ idea.id }}")'></div></td>
			{% endif %}
		</tr></table>
		{% endif %}
		
		<div class="user_choice_why">
			<h3>{{ idea.idea }}</h3>
		</div>
		
		<div class="user_restaurant">
			<h4>Order</h4>
		</div><!-- /demo-html -->
		<div class="user_choice_why">
			<h3>{{ idea.order }}</h3>
		</div><!-- /demo-html -->
		
		
		<div class="restaurant_photo">
			<img src="{{ idea.filename }}">
			<div class='icon loved' style='border: none;margin: -6px;background-position: -132px 0px;'></div>
			<div style='display: inline-block;vertical-align: top;font-size: 1.5em;padding: 2px 0px;'>{{ idea.like_count }}</div>
		</div>
		
		</br>
		</br>
		</br>
		
		<div class="getting_there"><p><strong>Getting There</strong></p></div>
		
		<div class="container_16"></div>
		<article class="grid_16"></article>
		<div class="item rounded dark">
			<div class='map_data lat' style='display:none;'>{{ idea.point.coordinates[1] }}</div>
			<div class='map_data lng' style='display:none;'>{{ idea.point.coordinates[0] }}</div>
			
			<div id="map_canvas" class="map rounded" ></div>
		</div>
		
		<div class="user_choice_why" style='display:none;'>
			<ul>
				<li>1800 Mission St, San Diego, CA</li>
				<li>Open: Monday - Friday, 10am - 7pm</li>
				<li>(555) - 555-1987</li>
			</ul>
		</div>
		</br>
		
		{% if current_user != None %}
			<div class="guest_book" id='guest_book'>
				<label for="textarea"><strong>Guest Book:</strong></label>
				<textarea name="textarea" id="textarea" placeholder="Been here? Tell {{ friend.user_name }} about your experience"></textarea>
			</div><!-- /demo-html -->
			
			<div class="Guest_book_next"><a onclick='add_comment()' data-role="button" style="background: #grey; color: black;">Add Your Comment</a></div>
			
			<div class='comments'>
			{% for comment in comments -%}
				<div class="user_choice_why_answered">
					<img src="{{ friends[comment.userid].picture }}" height="75" width="75"> 
					<ul>
						<li><strong>{{ friends[comment.userid].user_name }} {{ friends[comment.userid].user_last_name }}</strong></li>
						<li>{{ comment.comment_string }}</li>
					</ul>
					{% if current_user == comment.userid %}
						<div class='delete-entry transition' onclick='delete_comment(this, "{{ comment.id }}")' >X</div>
					{% endif %}
				</div>
			{%- endfor %}
			</div>
			{% include "sidebars.html" %}
		
		{% else %}
			{% include "sidebars_small.html" %}
			
		{% endif %}
		
		

	</div>
</div><!-- /page -->

{% endblock %}

{% block scripts %}
	<script src="static/js/mapquest.js"></script>
	
	<script>
	function add_comment(){
		var comment = $('#textarea').val();
		var id = '{{ idea.id }}';
		
		$.ajax({
			url: 'last_eat_entry',
			type: "post",
			data: {'comment': comment,
					'id': id},
			success: function(value) {
				console.log(value);
				$('#textarea').val('');
				$('.comments').append(value);
			}
		});
	}
	
	$(document).on('pageinit', function(event){
		$(".user_choice_why_answered").live('swipeleft', function() {
			show_delete(this);
		});
		$(".user_choice_why_answered").live('swiperight', function() {
			hide_delete(this);
		});
	});
	
	function show_delete(thisObject){
		$(thisObject).children('.delete-entry').css('right','0px');
	}
	function hide_delete(thisObject){
		$(thisObject).children('.delete-entry').css('right','-150px');
	}
	
	function delete_comment(thisObject, id){
		$.ajax({
			url: 'last_eat_entry',
			type: "delete",
			data: {'id': id},
			success: function(value) {
				$(thisObject).parent().remove();
			}
		});
	}
	
	
	function saveIdea(thisObject, id){
		$.ajax({
			url: 'save_idea',
			type: "post",
			data: {'userid': {{ user.userid }},
					'id': id},
			success: function(value) {
				console.log(value);
				$(thisObject).removeClass('save');
				$(thisObject).addClass('saved');
				
			}
		});
	}
	
	function loveIdea(thisObject, id){
		$.ajax({
			url: 'love_idea',
			type: "post",
			data: {'userid': {{ user.userid }},
					'id': id},
			success: function(value) {
				console.log(value);
				$(thisObject).removeClass('love');
				$(thisObject).addClass('loved');
			}
		});
	}
	</script>
{% endblock %}


